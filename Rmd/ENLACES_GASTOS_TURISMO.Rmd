---
title: ''
output:
  html_document:
    df_print: paged
    css: styles/MODULO.css
    # self_contained: false
    # lib_dir: libs
  pdf_document: default
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, error=FALSE)
```

```{r librerías, include=FALSE}
list.of.packages <- c("jsonlite", "ggplot2", "knitr", "data.table", "plotly", "plyr", "dplyr", "scales", "htmlwidgets", "sf", "fuzzyjoin", "xml2", "XML", "tidyverse", "tmap", "magrittr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
sapply(list.of.packages, require, character.only = TRUE)
```

```{r Funciones Enlaces, results="asis"}
get_indicator_mod = function(url, label) {
  return(sprintf("<div class='column-modulo-link'><p class='label_l'><a href=%s target='_blank'>%s</a></p></div>", url, label))
}
get_indicator_mod_first = function(url, label) {
  return(sprintf("<div class='column-modulo-link'><p class='label_l'><a href=%s target='_blank'>%s</a></p><hr class='separator'/>", url, label))
}
get_indicator_mod_inter = function(url, label) {
  return(sprintf("<p class='label_l'><a href=%s target='_blank'>%s</a></p><hr class='separator'/>", url, label))
}
get_indicator_mod_last = function(url, label) {
  return(sprintf("<p class='label_l'><a href=%s target='_blank'>%s</a></p></div>", url, label))
}
```

```{r csv Enlaces}
links <- read.csv2("../enlaces.csv", encoding = "UTF-8", sep = ",")
colnames(links)[1] <- "Tematica"
df_links <- links %>%
  filter(Tematica == "gastos_medios_turista") %>%
  select(!c(Tematica, Otros))
```

<!-- HTML -->
<h1 style="color: #008BD0; margin: 0; font-size: 36px;">Enlaces a los datos</h1>
<hr>
<h3 style="color: #666; margin: 12px; font-size: 16px;">Al pinchar en los títulos de la izquierda se accede a las tablas con las que se ha elaborado esta ficha.</h3>

<div class="row" style="margin-top: 10px;">
  `r get_indicator_mod(
        df_links$Enlace[which(df_links$Indicador == "Tema")],
        df_links$Titulo[which(df_links$Indicador == "Tema")])`

<div class="column-modulo-right">
<div class="highlight-modulo">

<p style="margin-bottom: 0;"> 
  <img src="img_dat/gt_encabezado.png"/>
</p>

</div>
</div>
</div>

<div class="row" style="margin-top: 10px;">
```{r Enlaces Indicador principal-Indicadores principales, results='asis'}
df_links_indicadores <- df_links %>%
  filter(Indicador %in% c("Indicador principal", "Indicadores principales") & !is.na(Enlace)) %>%
  distinct(Enlace, .keep_all = TRUE)

if (nrow(df_links_indicadores) == 1) {
  cat(paste0(
    get_indicator_mod(
      df_links_indicadores$Enlace[1],
      df_links_indicadores$Titulo[1])
    ))
  } else {
    cat(paste0(
      get_indicator_mod_first(
        df_links_indicadores$Enlace[1],
        df_links_indicadores$Titulo[1])
      ))
    if (nrow(df_links_indicadores) > 2) {
      if (nrow(df_links_indicadores) == 3) {
        cat(paste0(
          get_indicator_mod_inter(
            df_links_indicadores$Enlace[2],
            df_links_indicadores$Titulo[2])
          ))
        } else {
          for (i in c(2:(nrow(df_links_indicadores)-1))) {
            cat(paste0(
              get_indicator_mod_inter(
                df_links_indicadores$Enlace[i],
                df_links_indicadores$Titulo[i])
              ))
            } 
        }
    }
    cat(paste0(
      get_indicator_mod_last(
        df_links_indicadores$Enlace[nrow(df_links_indicadores)],
        df_links_indicadores$Titulo[nrow(df_links_indicadores)])
      ))
  }
```

<div class="column-modulo-right">
<div class="highlight-modulo">

<p style="margin-bottom: 0;"> 
  <img src="img_dat/gt_serie.png"/>
</p>

</div>
</div>
</div>

<div class="row" style="margin-top: 10px;">
```{r Enlaces Ranking, results='asis'}
df_links_ranking <- df_links %>%
  filter(Indicador == "Ranking" & !is.na(Enlace)) %>%
  distinct(Enlace, .keep_all = TRUE)

if (nrow(df_links_ranking) == 1) {
  cat(paste0(
    get_indicator_mod(
      df_links_ranking$Enlace[1],
      df_links_ranking$Titulo[1])
    ))
  } else {
    cat(paste0(
      get_indicator_mod_first(
        df_links_ranking$Enlace[1],
        df_links_ranking$Titulo[1])
      ))
    if (nrow(df_links_ranking) > 2) {
      if (nrow(df_links_ranking) == 3) {
        cat(paste0(
          get_indicator_mod_inter(
            df_links_ranking$Enlace[2],
            df_links_ranking$Titulo[2])
          ))
        } else {
          for (i in c(2:(nrow(df_links_ranking)-1))) {
            cat(paste0(
              get_indicator_mod_inter(
                df_links_ranking$Enlace[i],
                df_links_ranking$Titulo[i])
              ))
            } 
        }
    }
    cat(paste0(
      get_indicator_mod_last(
        df_links_ranking$Enlace[nrow(df_links_ranking)],
        df_links_ranking$Titulo[nrow(df_links_ranking)])
      ))
  }
```

<div class="column-modulo-right">
<div class="highlight-modulo">

<p style="margin: 0;"> 
  <img src="img_dat/gt_mapas.png"/>
</p>

</div>
</div>
</div>

<div class="row" style="margin-top: 10px;">
```{r Enlaces Otros indicadores 1, results='asis'}
df_links_otros1 <- df_links %>%
  filter(Indicador == "Otros indicadores 1" & !is.na(Enlace)) %>%
  distinct(Enlace, .keep_all = TRUE)

if (nrow(df_links_otros1) == 1) {
  cat(paste0(
    get_indicator_mod(
      df_links_otros1$Enlace[1],
      df_links_otros1$Titulo[1])
    ))
  } else {
    cat(paste0(
      get_indicator_mod_first(
        df_links_otros1$Enlace[1],
        df_links_otros1$Titulo[1])
      ))
    if (nrow(df_links_otros1) > 2) {
      if (nrow(df_links_otros1) == 3) {
        cat(paste0(
          get_indicator_mod_inter(
            df_links_otros1$Enlace[2],
            df_links_otros1$Titulo[2])
          ))
        } else {
          for (i in c(2:(nrow(df_links_otros1)-1))) {
            cat(paste0(
              get_indicator_mod_inter(
                df_links_otros1$Enlace[i],
                df_links_otros1$Titulo[i])
              ))
            } 
        }
    }
    cat(paste0(
      get_indicator_mod_last(
        df_links_otros1$Enlace[nrow(df_links_otros1)],
        df_links_otros1$Titulo[nrow(df_links_otros1)])
      ))
  }
```

<div class="column-modulo-right">
<div class="highlight-modulo" style="padding-bottom: 20px;">

<p style="margin-bottom: 0;"> 
  <img src="img_dat/gt_otros1.png"/>
</p>

</div>
</div>
</div>

<div class="row" style="margin-top: 10px;">
```{r Enlaces Otros indicadores 2, results='asis'}
df_links_otros2 <- df_links %>%
  filter(Indicador == "Otros indicadores 2" & !is.na(Enlace)) %>%
  distinct(Enlace, .keep_all = TRUE)

if (nrow(df_links_otros2) == 1) {
  cat(paste0(
    get_indicator_mod(
      df_links_otros2$Enlace[1],
      df_links_otros2$Titulo[1])
    ))
  } else {
    cat(paste0(
      get_indicator_mod_first(
        df_links_otros2$Enlace[1],
        df_links_otros2$Titulo[1])
      ))
    if (nrow(df_links_otros2) > 2) {
      if (nrow(df_links_otros2) == 3) {
        cat(paste0(
          get_indicator_mod_inter(
            df_links_otros2$Enlace[2],
            df_links_otros2$Titulo[2])
          ))
        } else {
          for (i in c(2:(nrow(df_links_otros2)-1))) {
            cat(paste0(
              get_indicator_mod_inter(
                df_links_otros2$Enlace[i],
                df_links_otros2$Titulo[i])
              ))
            } 
        }
    }
    cat(paste0(
      get_indicator_mod_last(
        df_links_otros2$Enlace[nrow(df_links_otros2)],
        df_links_otros2$Titulo[nrow(df_links_otros2)])
      ))
  }
```

<div class="column-modulo-right">
<div class="highlight-modulo" style="padding-bottom: 20px;">

<p style="margin-bottom: 0;"> 
  <img src="img_dat/gt_otros2.png"/>
</p>

</div>
</div>
</div>

<div class="row" style="margin-top: 10px;">
```{r Enlaces Otros indicadores 3, results='asis'}
df_links_otros3 <- df_links %>%
  filter(Indicador == "Otros indicadores 3" & !is.na(Enlace)) %>%
  distinct(Enlace, .keep_all = TRUE)

if (nrow(df_links_otros3) == 1) {
  cat(paste0(
    get_indicator_mod(
      df_links_otros3$Enlace[1],
      df_links_otros3$Titulo[1])
    ))
  } else {
    cat(paste0(
      get_indicator_mod_first(
        df_links_otros3$Enlace[1],
        df_links_otros3$Titulo[1])
      ))
    if (nrow(df_links_otros3) > 2) {
      if (nrow(df_links_otros3) == 3) {
        cat(paste0(
          get_indicator_mod_inter(
            df_links_otros3$Enlace[2],
            df_links_otros3$Titulo[2])
          ))
        } else {
          for (i in c(2:(nrow(df_links_otros3)-1))) {
            cat(paste0(
              get_indicator_mod_inter(
                df_links_otros3$Enlace[i],
                df_links_otros3$Titulo[i])
              ))
            } 
        }
    }
    cat(paste0(
      get_indicator_mod_last(
        df_links_otros3$Enlace[nrow(df_links_otros3)],
        df_links_otros3$Titulo[nrow(df_links_otros3)])
      ))
  }
```

<div class="column-modulo-right">
<div class="highlight-modulo" style="padding-bottom: 20px;">

<p style="margin-bottom: 0;"> 
  <img src="img_dat/gt_otros3.png"/>
</p>

</div>
</div>
</div>


<div class="row" style="margin-top: 10px;">
</div>
<div class="logo-fecam">
  <img src="img/fecam.jpeg" />
</div>
<div class="logo-istac"> 
  <img src="img/logo_istac.png" />
</div>

