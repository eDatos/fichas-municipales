---
title: ''
output:
  html_document:
    df_print: paged
    css: styles/MODULO.css
    # self_contained: false
    # lib_dir: libs
  pdf_document: default
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, error=FALSE)
```

```{r librerías, include=FALSE}
list.of.packages <- c("jsonlite", "ggplot2", "knitr", "data.table", "plotly", "plyr", "dplyr", "scales", "htmlwidgets", "sf", "fuzzyjoin", "xml2", "XML", "tidyverse", "tmap", "magrittr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
sapply(list.of.packages, require, character.only = TRUE)
```

```{r Funciones Enlaces, results="asis"}
get_indicator_mod = function(url, label) {
  return(sprintf("<div class='column-modulo-link'><p class='label_l'><a href=%s target='_blank'>%s</a></p></div>", url, label))
}
get_indicator_mod_first = function(url, label) {
  return(sprintf("<div class='column-modulo-link'><p class='label_l'><a href=%s target='_blank'>%s</a></p><hr class='separator'/>", url, label))
}
get_indicator_mod_inter = function(url, label) {
  return(sprintf("<p class='label_l'><a href=%s target='_blank'>%s</a></p><hr class='separator'/>", url, label))
}
get_indicator_mod_last = function(url, label) {
  return(sprintf("<p class='label_l'><a href=%s target='_blank'>%s</a></p></div>", url, label))
}
```

```{r csv Enlaces}
links <- read.csv2("../enlaces.csv", encoding = "UTF-8", sep = ",")
colnames(links)[1] <- "Tematica"
df_links <- links %>%
  filter(Tematica == "demografia") %>%
  select(!c(Tematica, Otros))
```

<!-- HTML -->
<h1 style="color: #008BD0; margin: 0; font-size: 36px;">Enlaces a los datos</h1>
<hr>
<h3 style="color: #666; margin: 12px; font-size: 16px;">Al pinchar en los títulos de la izquierda se accede a las tablas con las que se ha elaborado esta ficha.</h3>

<div class="row" style="margin-top: 10px;">
  `r get_indicator_mod(
        df_links$Enlace[which(df_links$Indicador == "Tema")],
        df_links$Titulo[which(df_links$Indicador == "Tema")])`

<div class="column-modulo-right">
<div class="highlight-modulo">

<p style="margin-bottom: 0;"> 
  <img src="img_dat/demogr_encabezado.png"/>
</p>

</div>
</div>
</div>

<div class="row" style="margin-top: 10px;">
  `r get_indicator_mod(
        df_links$Enlace[which(df_links$Indicador == "Indicador principal")],
        df_links$Titulo[which(df_links$Indicador == "Indicador principal")])`

<div class="column-modulo-right">
<div class="highlight-modulo" style="padding-bottom: 0px;>

<p style="margin-bottom: 0;"> 
  <img src="img_dat/demogr_serie.png"/>
</p>

</div>
</div>
</div>

<div class="row" style="margin-top: 10px;">
```{r Enlaces Indicadores principales, results='asis'}
df_links_principales <- df_links %>%
  filter(Indicador == "Indicadores principales" & !is.na(Enlace)) %>%
  distinct(Enlace, .keep_all = TRUE)

if (nrow(df_links_principales) == 1) {
  cat(paste0(
    get_indicator_mod(
      df_links_principales$Enlace[1],
      df_links_principales$Titulo[1])
    ))
  } else {
    cat(paste0(
      get_indicator_mod_first(
        df_links_principales$Enlace[1],
        df_links_principales$Titulo[1])
      ))
    if (nrow(df_links_principales) > 2) {
      if (nrow(df_links_principales) == 3) {
        cat(paste0(
          get_indicator_mod_inter(
            df_links_principales$Enlace[2],
            df_links_principales$Titulo[2])
          ))
        } else {
          for (i in c(2:(nrow(df_links_principales)-1))) {
            cat(paste0(
              get_indicator_mod_inter(
                df_links_principales$Enlace[i],
                df_links_principales$Titulo[i])
              ))
            } 
        }
    }
    cat(paste0(
      get_indicator_mod_last(
        df_links_principales$Enlace[nrow(df_links_principales)],
        df_links_principales$Titulo[nrow(df_links_principales)])
      ))
  }
```

<div class="column-modulo-right">
<div class="highlight-modulo" style="padding: 15px 0;">

<p style="margin-bottom: 0;"> 
  <img src="img_dat/demogr_indicadores.png"/>
</p>

</div>
</div>
</div>

<div class="row">
  `r get_indicator_mod(
        "",
        ""
        )`

<div class="column-modulo-right">
<!-- <div class="highlight-modulo"> -->

<p style="margin: 0 23px;"> 
  <img src="img_dat/demogr_mapas.png"/>
</p>

<!-- </div> -->
</div>
</div>

<div class="row">
```{r Enlaces Otros indicadores, results='asis'}
df_links_otros <- df_links %>%
  filter(Indicador == "Otros indicadores" & !is.na(Enlace)) %>%
  distinct(Enlace, .keep_all = TRUE)

if (nrow(df_links_otros) == 1) {
  cat(paste0(
    get_indicator_mod(
      df_links_otros$Enlace[1],
      df_links_otros$Titulo[1])
    ))
  } else {
    cat(paste0(
      get_indicator_mod_first(
        df_links_otros$Enlace[1],
        df_links_otros$Titulo[1])
      ))
    if (nrow(df_links_otros) > 2) {
      if (nrow(df_links_otros) == 3) {
        cat(paste0(
          get_indicator_mod_inter(
            df_links_otros$Enlace[2],
            df_links_otros$Titulo[2])
          ))
        } else {
          for (i in c(2:(nrow(df_links_otros)-1))) {
            cat(paste0(
              get_indicator_mod_inter(
                df_links_otros$Enlace[i],
                df_links_otros$Titulo[i])
              ))
            } 
        }
    }
    cat(paste0(
      get_indicator_mod_last(
        df_links_otros$Enlace[nrow(df_links_otros)],
        df_links_otros$Titulo[nrow(df_links_otros)])
      ))
  }
```

<div class="column-modulo-right">
<div class="highlight-modulo" style="padding-bottom: 20px;">

<p style="margin-bottom: 0;"> 
  <img src="img_dat/demogr_otros.png"/>
</p>

</div>
</div>
</div>


<div class="row" style="margin-top: 10px;">
</div>
<div class="logo-fecam">
  <img src="img/fecam.jpeg" />
</div>
<div class="logo-istac"> 
  <img src="img/logo_istac.png" />
</div>

