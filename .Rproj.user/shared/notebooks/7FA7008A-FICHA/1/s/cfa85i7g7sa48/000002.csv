"0","piramide <- fromJSON(params$url.piramide)"
"0","df_piramide <- cbind(data.frame(do.call('rbind', piramide[[""data""]][[""dimCodes""]])), piramide[[""data""]][[""Valor""]])"
"0","colnames(df_piramide) <- c('mun', 'gredad', 'año', 'sexo', 'valor')"
"0","df_piramide$sexo <- factor(df_piramide$sexo , levels=piramide[[""categories""]][[""codes""]][[4]], labels=piramide[[""categories""]][[""labels""]][[4]])"
"0","df_piramide$valor <- as.numeric(df_piramide$valor)"
"0","df_piramide$año <- as.numeric(df_piramide$año)"
"0","df_piramide$gredad <- ordered(df_piramide$gredad, levels = piramide[[""categories""]][[""codes""]][[2]])"
"0",""
"0","Num_Pobl_Isla <- df_piramide %>% filter(mun == municipio_actual$id_isla & gredad == ""T"" & sexo == ""AMBOS SEXOS"" & año == params$año) %>% select(valor) %>%  as.numeric()"
"0","df_piramide$mun <- factor(df_piramide$mun , levels=piramide[[""categories""]][[""codes""]][[1]], labels=piramide[[""categories""]][[""labels""]][[1]])"
"0","df_piramide$mun <- recode_mun(df_piramide, 'mun')"
"2","The following `from` values were not present in `x`: Pinar de El Hierro, El
"
"0","Num_Pobl_Canarias <- df_piramide %>% filter(mun == ""CANARIAS"" & gredad == ""T"" & sexo == ""AMBOS SEXOS"" & año == params$año) %>% select(valor) %>%  as.numeric()"
"0",""
"0","df_piramide_plot <- df_piramide %>% filter(gredad %notin% c(""T"",""0 a 14"",""65 ó más"",""15 a 64"") & sexo != ""AMBOS SEXOS"" & año == params$año) %>%"
"0","  select(gredad, sexo, valor, mun)%>%"
"0","  transform(valor = if_else(sexo == ""Hombres"", -valor, valor), gredad = ifelse(grepl(""ó"", gredad, fixed = TRUE), gsub("" ó "", ""-"", gredad), gsub("" a "", ""-"", gredad))) %>%"
"0","  transform(order = as.numeric(unlist(lapply(strsplit(gredad, ""-""), '[[', 1)))) %>% "
"0","  transform(gredad = ifelse(gredad == ""100-más"","">99"",gredad)) %>%"
"0","  arrange(desc(order))"
"0",""
"0","df_Canarias <- df_piramide_plot %>% filter(mun == ""CANARIAS"")"
"0","df_mun <- df_piramide_plot %>% filter(mun == municipio_actual$municipio)"
"0","df_mun <- cbind(df_mun, porcentaje = df_mun$valor / Num_Pobl_num, valor_Canarias = df_Canarias$valor, porcentaje_Canarias = df_Canarias$valor / Num_Pobl_Canarias)"
"0",""
"0","df_mun <- df_mun %>% transform("
"0","  hovertext = paste0("
"0","    ifelse(sexo == ""Hombres"", paste0(""<b>"", gredad,"" años</b><br>""), """"),"
"0","    ""<br><b>"", sexo, ""</b>"","
"0","    ""<br>"", trimws(format(abs(valor), big.mark = ""."", decimal.mark = "","")),"
"0","    "" ("", trimws(format(round(abs(porcentaje)*100, 1), big.mark = ""."", decimal.mark = "","")), ""%)"","
"0","    ""<br>Canarias: "", trimws(format(abs(valor_Canarias), big.mark = ""."", decimal.mark = "","")),"
"0","    "" ("", trimws(format(round(abs(porcentaje_Canarias)*100, 1), big.mark = ""."", decimal.mark = "","")), ""%)"""
"0","  )"
"0",")"
"0",""
"0","g_piramide <- ggplot(data = df_mun, aes(x = reorder(gredad,order), fill = sexo, group = sexo, text = hovertext)) +"
"0","  geom_bar(stat = ""identity"", alpha = 0.8, width = 0.99, aes(y = porcentaje)) + "
"0","  geom_bar(stat = ""identity"", color = ""#59656E"", alpha = 0, width = 0.99, size = 0.4, aes(y = porcentaje_Canarias, text = """")) +"
"0","  coord_flip() + "
"0","  theme_minimal() +"
"0","  labs(x = NULL, y = NULL, colour = "" "") +"
"0","  guides(fill = FALSE) +"
"0","  scale_fill_manual(values = c(""Mujeres"" = ""#8CD2EA"", ""Hombres"" = ""#005980"")) +"
"0","  theme(axis.text.x = element_text(),"
"0","        axis.line = element_blank(),"
"0","        panel.grid.major.y = element_blank(),"
"0","        panel.grid.minor.y = element_blank(),"
"0","        panel.grid.major.x = element_line(colour = ""lightgray""),"
"0","        panel.grid.minor.x = element_line(colour = ""lightgray""),"
"0","        panel.background = element_rect(fill = ""white""),"
"0","        legend.position = ""none"") +"
"0","  scale_y_continuous(n.breaks = 7, labels = function(x) { paste0(format(abs(x) * 100, big.mark = '.', decimal.mark = "",""), '%') },"
"0","                     limits = c(-1, 1)*max(abs(df_mun$porcentaje), abs(df_mun$porcentaje_Canarias)))"
"0","  "
"0","g_piramide <- ggplotly(g_piramide, tooltip = c(""text"")) %>%"
"0","              layout(margin = list(t=10), hovermode = ""y unified"") %>%"
"0","              config(displaylogo = FALSE, modeBarButtons = list(list(""zoom2d""),list(""pan2d""),list(""resetScale2d""),list(""toImage""))) %>%"
"0","              style(hoverinfo = ""skip"", traces = c(3, 4))"
